/*!
 * jQuery Ken Burns plugin
 * http://labs.codapixa.com/jquery.kenburns
 *
 * Licensed under MIT License http://opensource.org/licenses/mit-license.php
 * Copyright (c) 2012 Codapixa
 *
 * Version: 0.1
 * Author: Firman W <firmanw@codapixa.com>
 *
 * Version 0.2
 * Author: https://github.com/JBlond/jquery.kenburns
 */
!function(a){var b=function(b,c){return this.target=b,this.options=a.extend({},this.defaults,c),this.init(),this};b.prototype={defaults:{duration:7e3,width:940,height:360,align:"random",zoom:1.1,debug:!1},canvas:null,image:null,interval:0,actual:{},state:"init",time:0,scale:1,align:"center",init:function(){var b=this;jQuery("<img />").attr("src",jQuery(b.target).attr("src")).load(function(){null===b.canvas&&(jQuery(b.target).hide(),b.canvas=a("<canvas />")[0],jQuery(b.canvas).appendTo(jQuery(b.target).parent())),b.image=this,b.canvas.width=b.options.width,b.canvas.height=b.options.height,b.actual.width=b.canvas.width,b.actual.height=Math.floor(b.canvas.width/b.image.width*b.image.height),b.actual.x=(b.actual.width-b.canvas.width)/2*-1,b.actual.y=(b.actual.height-b.canvas.height)/2*-1,b.start()})},_context:function(){return this.canvas.getContext("2d")},_redraw:function(){var a=this,b=a._context();b.clearRect(0,0,a.canvas.width,a.canvas.height),b.drawImage(a.image,0,0,a.image.width,a.image.height,a.actual.x,a.actual.y,a.actual.width,a.actual.height),b.save()},_log:function(a){this.options.debug&&console.log("jQuery.kenburns > %s",a)},start:function(){"finish"!==this.state&&(0===this.time&&this._redraw(),this.exec())},exec:function(){var a=this,b=a._context(),c=function(a){var b=new Date;return b.getTime()-a},d=function(a,b,c,d,e,f,g){var h=0,i=0;switch(g){case"top":h=(e-c)/2*-1;break;case"left":i=(f-d)/2*-1;break;case"bottom":h=(e-c)/2*-1,i=-1*(f-d);break;case"right":h=-1*(e-c),i=(f-d)/2*-1;break;default:h=(e-c)/2*-1,i=(f-d)/2*-1}return{x:a+h,y:b+i}},e=["top","left","center","bottom","right"],f=function(a,b,c){var e=Math.floor(a.width*b),f=Math.floor(a.height*b),g=d(a.x,a.y,a.width,a.height,e,f,c);return{x:g.x,y:g.y,width:e,height:f}};"animate"!==a.state&&("random"===a.options.align?a.align=e[Math.floor(Math.random()*e.length)]:a.align=a.options.align),0===a.time&&(a.time=c(0)),a.state="animate",a.interval=setInterval(function(){var d=f(a.actual,a.scale,a.align),e=c(a.time);return a._log("State: "+a.state+", Passed: "+e+", Scale: "+a.scale+", Align: "+a.align),b.drawImage(a.image,0,0,a.image.width,a.image.height,d.x,d.y,d.width,d.height),b.save(),e>=a.options.duration?(a.state="finish",clearInterval(a.interval),!1):void(a.scale+=Math.abs(a.options.zoom-1)/a.options.duration*30)},30)},set:function(b){this.options=a.extend(this.options,b)},reset:function(){this.scale=1,this.time=0,this.state="reset",clearInterval(this.interval),this.start()},pause:function(){clearInterval(this.interval)},stop:function(){this.scale=1,this.time=0,this.state="stop",clearInterval(this.interval)}},jQuery.fn.kenburns=function(a){var c=arguments;return this.each(function(){var d=jQuery(this).data("kenburns")||{};return d[a]?d[a].apply(d,Array.prototype.slice.call(c,1)):"object"!=typeof a&&a?void jQuery.error("Method "+a+" does not exist on jQuery.kenburns"):(d=new b(this,a),jQuery(this).data("kenburns",d),this)})}}(jQuery);